<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesi√≥n - ChiliX</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
</head>
<!-- scripts -->
<script src="/backend/config/config.js"></script>
<script src="script.js"></script>
<body>


    <div class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <span class="logo-chili">Chili</span><span class="logo-x">X</span>
                </div>
                <h2>Bienvenido</h2>
                <p>Inicia sesi√≥n o crea tu cuenta</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('login')">Iniciar Sesi√≥n</button>
                <button class="tab" onclick="switchTab('register')">Registrarse</button>
            </div>

            <div class="success-message" id="successMessage">
                <p>‚úÖ <span id="successText"></span></p>
            </div>

            <!-- Formulario de Login -->
            <div class="form-section active" id="loginForm">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">üìß Correo electr√≥nico</label>
                        <input type="email" id="loginEmail" placeholder="tu@correo.com" required>
                    </div>

                    <div class="form-group">
                        <label for="loginPassword">üîí Contrase√±a</label>
                        <input type="password" id="loginPassword" placeholder="Tu contrase√±a" required>
                    </div>

                    <button type="submit" class="submit-btn">
                        Iniciar Sesi√≥n
                    </button>
                </form>

                <div class="backend-notice">
                    <h4>‚ö†Ô∏è MODO SIMULACI√ìN</h4>
                    <p>
                        Actualmente el sistema funciona con localStorage.<br>
                        Para autenticaci√≥n real se requiere:<br>
                        <strong>‚Ä¢ Backend (Node.js + Express)</strong><br>
                        <strong>‚Ä¢ Base de datos MySQL</strong><br>
                        <strong>‚Ä¢ Sistema de sesiones</strong>
                    </p>
                </div>
            </div>

            <!-- Formulario de Registro -->
            <div class="form-section" id="registerForm">
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerNombre">üë§ Nombre completo</label>
                        <input type="text" id="registerNombre" placeholder="Tu nombre" required>
                    </div>

                    <div class="form-group">
                        <label for="registerEmail">üìß Correo electr√≥nico</label>
                        <input type="email" id="registerEmail" placeholder="tu@correo.com" required>
                    </div>

                    <div class="form-group">
                        <label for="registerTelefono">üì± Tel√©fono (WhatsApp)</label>
                        <input type="tel" id="registerTelefono" placeholder="55 1234 5678" required>
                    </div>

                    <div class="form-group">
                        <label for="registerPassword">üîí Contrase√±a</label>
                        <input type="password" id="registerPassword" placeholder="M√≠nimo 6 caracteres" minlength="6"
                            required>
                    </div>

                    <button type="submit" class="submit-btn">
                        Crear Cuenta
                    </button>
                </form>

                <div class="backend-notice">
                    <h4> MODO SIMULACI√ìN</h4>
                    <p>
                        Las cuentas se guardan temporalmente en tu navegador.<br>
                        Con backend real tendr√°s:<br>
                        <strong>‚Ä¢ Verificaci√≥n de email</strong><br>
                        <strong>‚Ä¢ Contrase√±as encriptadas</strong><br>
                        <strong>‚Ä¢ Historial de pedidos</strong>
                    </p>
                </div>
            </div>

            <a href="index.html" class="back-link">‚Üê Volver al inicio</a>
        </div>
    </div>

    <script>
        // Cambiar entre tabs
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const forms = document.querySelectorAll('.form-section');

            tabs.forEach(t => t.classList.remove('active'));
            forms.forEach(f => f.classList.remove('active'));

            if (tab === 'login') {
                tabs[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        // Mostrar mensaje de √©xito
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successDiv.classList.add('show');

            setTimeout(() => {
                successDiv.classList.remove('show');
            }, 3000);
        }

        // Login con URL din√°mica
        async function handleLogin(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                //  Usar CONFIG.API_URL en lugar de localhost
                const response = await fetch(`${CONFIG.API_URL}/api/usuarios/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Guardar sesi√≥n
                    localStorage.setItem('chilixUser', JSON.stringify(data.data));
                    showSuccess('¬°Bienvenido de nuevo!');

                    setTimeout(() => {
                        window.location.href = 'carrito.html';
                    }, 1500);
                } else {
                    alert('‚ùå ' + data.error);
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Error al iniciar sesi√≥n. Verifica tu conexi√≥n.');
            }
        }

        // Registro con URL, dinamica?
        async function handleRegister(event) {
            event.preventDefault();

            const nombre = document.getElementById('registerNombre').value;
            const email = document.getElementById('registerEmail').value;
            const telefono = document.getElementById('registerTelefono').value;
            const password = document.getElementById('registerPassword').value;

            try {
                //  Usar CONFIG.API_URL en lugar de localhost
                const response = await fetch(`${CONFIG.API_URL}/api/usuarios/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nombre, email, telefono, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Guardar sesi√≥n
                    localStorage.setItem('chilixUser', JSON.stringify(data.data));
                    showSuccess('¬°Cuenta creada exitosamente!');

                    setTimeout(() => {
                        window.location.href = 'carrito.html';
                    }, 1500);
                } else {
                    alert('‚ùå ' + (data.error || 'Error al registrar'));
                }

            } catch (error) {
                console.error('Error:', error);
                alert('Error al crear cuenta. Verifica tu conexi√≥n.');
            }
        }

        // Verificar si ya est√° logueado
        window.addEventListener('DOMContentLoaded', () => {
            const user = localStorage.getItem('chilixUser');
            if (user) {
                // Redirigir directamente al carrito sin preguntar
                window.location.href = 'carrito.html';
            }
        });
    </script>

</body>

</html>